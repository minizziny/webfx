<link href="script/layoutEngine/layoutEngine.css" rel="stylesheet" media="screen">
<link href="css/dashboard.css" rel="stylesheet" media="screen">

<style>
dockpanel, widget {
	display: block;
}

dockpanel {
	/*border: 1px solid blue;*/
}

[modal].propertyWidget {
	width: 600px;
	margin-left: -300px;
}

/* widget */

widget {
	/*border: 1px dotted red;*/
	margin: 0px;
	height: calc(100% - 4px);
}

.contentbox > [ng-transclude] {
	height: 100%;
}

/* widget end */

.box {
	float: left;
	width: 180px;
	height: 180px;
	background-color: #eee;
	margin: 10px;
	border: 1px solid gray;

}

dockpanel {
	width: 100%;
	height: calc(100% - 4px);
}

.contentbox .tab-content {
	overflow: visible;
	height: calc(100% - 20px);
	border-bottom: 1px solid #ddd;
	border-left: 1px solid #ddd;
	border-right: 1px solid #ddd;
}


/* widget-droppable */

@-webkit-keyframes blinker {
	from {
		background-color: #08c;
		color: white;
	}
	to {
		background-color: white;
		color: #08c;
	}
}

[widget-droppable] {
	position: relative;
}

.nav-tabs>li [widget-droppable].over {
	/*background-color: yellow;*/
	-webkit-animation-name: blinker;
	-webkit-animation-iteration-count: infinite;
	-webkit-animation-timing-function: cubic-bezier(1.0,0,0,1.0);
	-webkit-animation-duration: 0.2s;
}

.nav-tabs>li.active [widget-droppable].over {
	/*background-color: #fff;*/
	-webkit-animation: none;
}

[widget-droppable] > .widget-drop-zone {
	/*z-index: 9989;*/
	position: absolute;
	top: -1px;
	left: 0;
	right: 0;
	bottom: 0;
	padding: 2px 4px;
}


/* click-to-edit inner tab */ 

[widget-droppable] > .widget-drop-zone * {
	display: none;
}

.nav-tabs>li.active [widget-droppable] > .widget-drop-zone * {
	display: block;
}

.nav-tabs>li.active [widget-droppable] > .widget-drop-zone > input[type=text] {
	padding: 2px 6px;
	box-sizing: border-box;
	width: calc(100% - 20px);
	margin: 0 1px;
}

/* click-to-edit inner tab end */ 



widget > .tab-comp {

}

widget > .tab-comp > ul.nav-tabs {
	display: flex;
}

	widget > .tab-comp > ul.nav-tabs > li:before, widget > .tab-comp > ul.nav-tabs > li {
		background-image: -webkit-linear-gradient(top, #e8e8e8, #d9d9d9);
		border-top: 1px solid #b9b9b9;
	}
	
	widget > .tab-comp > ul.nav-tabs > li.active:before, widget > .tab-comp > ul.nav-tabs > li.active {
		/*background: #f0f0f0;*/
		border-top: 1px solid #c00;
		height: 21px;
		box-shadow: none;
		background-image: linear-gradient(to bottom, #c00 0px, #c00 1px, #fff 1.1px);
		background-repeat: no-repeat;
	}
	
	widget > .tab-comp > ul.nav-tabs > li:before {
		content: '';
		position: absolute;
		top: -1px;
		left: -16px;
		height: 20px;
		width: 30px;
		border-top-left-radius: 3px;
		border-left: 1px solid #b9b9b9;
		box-shadow: inset 1px -1px 1px rgba(0, 0, 0, 0.05);
		-webkit-transform: skewX(133deg);
	}

	widget > .tab-comp > ul.nav-tabs > li:first-child {
		margin-left: 30px;
	}
	
	widget > .tab-comp > ul.nav-tabs > li {
		flex: 1;
		max-width: 175px;
		min-width: 40px;
		padding-right: 24px;
	
		position: relative;
		top: 3px;
		height: 20px;
		line-height: 20px;
		color: #444444;
		padding-left: 0;
		margin-left: 15px;
		border-top-right-radius: 3px;
		border-right: 1px solid #b9b9b9;
		box-shadow: inset -1px -1px 1px rgba(0, 0, 0, 0.05);
		/*-webkit-transform: skewX(30deg);*/
		transition: color 0.1s ease-in;
	
		display: inline-block;
	}
	
	
	widget > .tab-comp > ul.nav-tabs > li > a {
		padding: 2px 4px;
		font-size: 0.9em;
		margin-right: 0;
		border-radius: 0;
		background-color: transparent;
		border: 0;
		padding-top: 1px;
	
		/*-webkit-transform: skewX(-30deg);*/
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
	}
	
	widget > .tab-comp > ul.nav-tabs > li > a:hover {
		background-color: transparent;
		border: 0;
	}
	
	widget > .tab-comp > ul.nav-tabs > li.active {
		z-index: 10;
		line-height: 24px;
		color: #000000;
	}
	
	widget > .tab-comp > ul.nav-tabs > li.active > a {
		color: transparent;
	}


widget > .tab-comp > ul.nav-tabs > button {
	margin-bottom: -4px;
	margin-top: 3px;
	z-index: 2;
}

widget > .tab-comp > ul.nav-tabs > li.plus {
	flex: none;
	width: 28px;
	cursor: pointer;
}

widget > .tab-comp > ul.nav-tabs > li.plus > button {
	line-height: 24px;
	outline: none;
}

widget > .tab-comp > ul.nav-tabs > li > button.tab-close {
	position: absolute;
	right: 6px;
	top: -1px;
}

widget > .tab-comp > ul.nav-tabs > li > button.tab-home {
	position: absolute;
	right: 24px;
	top: 3px;
}

widget[grid] .widget-grid-container {
	overflow: auto;
	height: 100%;
}

widget[chart] .widget-chart, widget[wcloud] .widget-wordcloud  {
	overflow: hidden;
}

widget {
	background-color: #fff;
}

widget.w-running {
	background-color: white;
}

widget.w-before-loading:before {
	content: 'Loading...';
	color: #aaa; 
	left: 50%;
	position: absolute;
	margin-left: -20px;
	top: 50%;
	margin-top: -10px;
	font-size: 13pt;
	text-shadow: 1px 1px 2px #ddd;
	letter-spacing: 1px;
}

</style>

<div class="dashboard-container" ng-controller="DashboardController">
	<div class="toolbar navbar navbar-top" style="margin-bottom: 0px">
		<div class="navbar-inner">
			<!--<select style="float: left; margin-top: 5px; margin-bottom: 0; margin-left: 5px" ng-model="selectedPreset" ng-options="preset.name for preset in dataPresetList"></select>
			-->
			<div class="btn-group">
				<button class="btn btn-small dropdown-toggle" data-toggle="dropdown">
					{{'$S_str_NewPreset' | translate}}
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li><a tabindex="-1" ng-click="New()">{{'$S_str_BlankPreset' | translate}}</a></li>
					<li><a tabindex="-1" ng-click="SaveAs()">{{'$S_str_SavePresetAs' | translate}}</a></li>
				</ul>
			</div>
			<div class="btn-group">
				<button class="btn btn-small dropdown-toggle" data-toggle="dropdown">
					{{'$S_str_LoadPreset' | translate}}
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li ng-repeat="(i,preset) in dataPresetList | filter:{parent: null}">
						<a tabindex="-1" ng-click="Load(preset)" style="padding-left:10px">
							<i ng-class="{ 'icon-ok': preset.guid == currentPreset.guid, 'icon-noncheck': preset.guid != currentPreset.guid }"></i>
							{{preset.name}}
						</a>
					</li>
				</ul>
			</div>
			<div class="btn-group">
				<button class="btn btn-small dropdown-toggle" data-toggle="dropdown">
					<i class="icon-wrench"></i>
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li><a tabindex="-1" ng-click="AlertRemove()">{{'$S_str_RemoveThisPreset' | translate}}</a></li>
					<!-- <li class="divider"></li>
					<li><a tabindex="-1" ng-click="AlertClear()">{{'$S_str_RemoveAllWidgets' | translate}}</a></li> -->
				</ul>
			</div>
			<button class="btn btn-small btn-primary pull-right" style="margin-right: 5px" ng-click="openNewWidget()">{{'$S_str_AddWidget' | translate}}</button>
			<div class="brandpreset" click-to-edit ng-model="currentPreset.name" ng-change="RenamePreset($new)" ng-cancel="" ng-toggle=""></div>
		</div>

		<div class="modal clearWidgets" modal>
			<a class="modal-close close" style="margin-bottom: -30px">&times;</a>
			<legend>{{'$S_str_RemoveAllWidgets' | translate}}</legend>
			<div style="margin-bottom: 20px">
				{{'$S_msg_RemoveAllWidgets' | translate}}
			</div>
			<div class="control-group submit-group">
				<button class="btn btn-danger" ng-click="Clear()">{{'$S_str_Remove' | translate}}</button>
				<button class="btn" ng-click="CancelClear()">{{'$S_str_Cancel' | translate}}</button>
			</div>
		</div>

		<div class="modal removePreset" modal>
			<a class="modal-close close" style="margin-bottom: -30px">&times;</a>
			<legend>{{'$S_str_RemovePreset' | translate}}</legend>
			<div style="margin-bottom: 20px">
				{{'$S_msg_RemovePresetConfirmPre' | translate}}<code>{{currentPreset.name}}</code>{{'$S_msg_RemovePresetConfirmPost' | translate}}
			</div>
			<div class="control-group submit-group">
				<button class="btn btn-danger" ng-click="Remove()">{{'$S_str_Remove' | translate}}</button>
				<button class="btn" ng-click="CancelRemove()">{{'$S_str_Cancel' | translate}}</button>
			</div>
		</div>
		<!--{{ctxPreset}}
		<hr>
		{{currentPreset}}-->
	</div>

	<div class="preset-container">
		<div class="dockpanel"></div>
	</div>

	<div class="modal arrangeWidget" modal>
		<div class="pull-left" style="margin-top:5px">{{'$S_msg_BeforeAddWidgetNotifyDragAndDrop' | translate}}</div>
		<button class="btn btn-danger pull-right" ng-click="cancelAddWidget()">{{'$S_str_Cancel' | translate}}</button>
	</div>
	
	<div class="modal errorWin" modal>
		<a class="modal-close close" ng-click="clearError()">&times;</a>
		<div class="raw"></div>
	</div>

	<div class="modal newWidget step0" modal ng-controller="NewWidgetWizardController">
		<a class="modal-close close">&times;</a>
		<ol class="wizard">
			<!-- 0 -->
			<li class="wiz-step active">
				<legend>{{'$S_str_SelectWidgetType' | translate}}</legend>
				<fieldset>
					<div class="fieldset-description">{{'$S_msg_SelectWidgetType' | translate}}</div>
					<ul class="radio">
						<li>
							<input type="radio" ng-model="widgetTypeName" value="table" ng-change="selectType(0)" id="radioTable">
							<label class="radio" for="radioTable">{{'$S_str_Table' | translate}}</label>
						</li>
						<li>
							<input type="radio" ng-model="widgetTypeName" value="graph" ng-change="selectType(1)" id="radioGraph">
							<label class="radio" for="radioGraph">{{'$S_str_Chart' | translate}}</label>
						</li>
					</ul>
					<div style="margin-bottom: 20px" ng-bind="selectedParserFactory.description"></div>
					<div class="control-group submit-group">
						<button class="wiz-next btn" ng-click="go(1, widgetType.s0nextCallback())">{{'$S_str_Next' | translate}}</button>
					</div>
				</fieldset>
			</li>
			<!-- 1 -->
			<li class="wiz-step">
				<legend>{{'$S_str_QueryData' | translate}}</legend>
				<fieldset>
					<div class="fieldset-description">{{'$S_msg_QueryData' | translate}}</div>
					<div>
						<query-input
							class="qi1"
							ng-model="qresult"
							ng-page-size="numPagerPagesize"
							ng-query-string="ctxWidget.data.query"
							ng-pid="getPid"
							on-loading="inputOnloading($msg)"
							on-error="inputOnError($type, $note)"
							on-loaded="inputOnStatusChange($msg, $inst)"
							on-status-change="inputOnStatusChange($msg, $inst)"></query-input>
						<div class="qr-container" style="width: 880px; margin-top:10px">
							<div class="paneError" ng-show="isOnError">
								<div class="alert alert-error inner" style="text-align:center; margin: 0">
									<img class="cicon-error">
									<h4>{{'$S_msg_WrongQuery' | translate}}</h4>
									<ul>
										<li>{{'$S_str_Type' | translate}}: {{errorType | translate}}</li>
										<li>{{'$S_str_Note' | translate}}: {{errorNote | translate}}</li>
									</ul>
								</div>
							</div>
							<query-result class="qr1"
								ng-model="qresult"
								ng-query="ctxWidget.data.query"
								ng-page="numCurrentPage"
								ng-page-size="numPagerPagesize"
								is-check-type="true"></query-result>
						</div>
					</div>
					<div class="control-group submit-group">
						<button class="wiz-prev btn" ng-click="go(0, widgetType.s0prevCallback())">{{'$S_str_Previous' | translate}}</button>
						<button class="wiz-next btn" ng-disabled="!isPageLoaded" ng-click="go(widgetType.s1next, null, widgetType.s1nextEvent())">{{'$S_str_Next' | translate}}</button>
					</div>
				</fieldset>
			</li>
			<!-- 2 -->
			<li class="wiz-step">
				<legend>{{'$S_str_SelectAndReorderColumn' | translate}}</legend>
				<fieldset>
					<div class="fieldset-description">{{'$S_msg_SelectAndReorderColumn' | translate}}</div>
					<div>
						<div class="qr-container" style="width: 780px; float: left">
							<query-result class="qr2 qr-select-table"
								ng-model="qresult"
								ng-query="ctxWidget.data.query" 
								ng-page="numCurrentPage"
								ng-page-size="numPagerPagesize"
								is-check-type="true"></query-result>
						</div>
						<ul class="listbox arrangeCols" ui-sortable ng-model="qrCols">
							<li ng-repeat="(i, col) in qrCols">
								<input type="checkbox" ng-model="col.is_visible">
								<span>{{col.name}}</span>
							</li>
						</ul>
					</div>
					<div class="control-group submit-group clearboth">
						<button class="wiz-prev btn" ng-click="go(1)">{{'$S_str_Previous' | translate}}</button>
						<button class="wiz-next btn" ng-click="go(3)">{{'$S_str_Next' | translate}}</button>
					</div>
				</fieldset>
			</li>
			<!-- 3 -->
			<li class="wiz-step">
				<legend>{{'$S_str_WidgetCommonSetting' | translate}}</legend>
				<fieldset>
					<div class="fieldset-description">{{'$S_msg_WidgetCommonSetting' | translate}}</div>
					<form name="formWidgetCommon" class="form-horizontal">
						<div class="control-group">
							<label class="control-label" for="widgetName">{{'$S_str_Name' | translate}}</label>
							<div class="controls">
								<input id="widgetName" type="text" ng-model="ctxWidget.name" required/>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="widgetInterval">{{'$S_str_Interval' | translate}}</label>
							<div class="controls">
								<input id="widgetInterval" type="number" ng-model="ctxWidget.interval" min="5"/> <ng-pluralize count="ctxWidget.interval" when="formSecond"></ng-pluralize>
							</div>
						</div>
					</form>
					<div class="control-group submit-group clearboth">
						<button class="wiz-prev btn" ng-click="go(widgetType.s3prev())">{{'$S_str_Previous' | translate}}</button>
						<button class="wiz-next btn" ng-click="submit()" ng-disabled="formWidgetCommon.$invalid || ctxWidget.name == undefined">{{'$S_str_Done' | translate}}</button>
					</div>
				</fieldset>
			</li>

			<!-- 4 -->
			<li class="wiz-step" ng-controller="SelectColumnController">
				<legend>{{'$S_str_BindingDataToChart' | translate}}</legend>
				<fieldset>
					<div class="alert alert-error check-col-info" style="display:none">
						<button type="button" class="close" data-dismiss="alert">&times;</button>
						<span></span>
					</div>
					<div class="well clearfix">
						<span class="pull-left" style="margin-top: 12px;margin-right: 10px">{{'$S_msg_SelectChartType' | translate}}</span>
						<div class="btn-group pull-left" data-toggle="buttons-radio">
							<button class="btn btn-large active" data-toggle="button" ng-click="selectChartType(0)">{{'$S_str_BarChart' | translate}}</button>
							<button class="btn btn-large" data-toggle="button" ng-click="selectChartType(1)">{{'$S_str_LineChart' | translate}}</button>
							<button class="btn btn-large" data-toggle="button" ng-click="selectChartType(2)">{{'$S_str_PieChart' | translate}}</button>
							<button class="btn btn-large" data-toggle="button" ng-click="selectChartType(3)">{{'$S_str_WordCloud' | translate}}</button>
						</div>
					</div>
					<div class="clearfix" style="margin-top: 20px">
						<div class="fieldset-description">
							<span style="margin-left: 10px">{{'$S_msg_SelectColumn' | translate}}</span>
							<a ng-click="showMoreColOption($event)" ng-hide="moreCol">{{'$S_msg_NoSelectableColumn' | translate}}</a>
							<div class="well" style="margin-top: 5px" ng-show="moreCol" ng-class="{ moreCol: moreCol }">
								<div style="margin-bottom: 5px;line-height: 2;">{{'$S_msg_SelectableColumn' | translate}}</div>
								<label style="display:inline">{{'$S_str_ColumnName' | translate}}</label> <input type="text" ng-model="dataCustomColumn">
								<label style="display:inline">{{'$S_str_ColumnType' | translate}}</label>
								<select ng-model="selectedCustomColumnType" ng-options="ct.displayName for ct in dataCustomColumnTypes"></select>
								<button class="btn pull-right" style="margin-bottom:-2px" ng-click="addCustomColumn()">{{'$S_str_AddAndSelectColumn' | translate}}</button>
							</div>
						</div>
						<div class="qr-container" style="width: 978px; height: 240px; overflow: scroll; margin-top: 5px">
							<query-result
								ng-model="qresult"
								ng-query="ctxWidget.data.query" 
								ng-page="numCurrentPage"
								ng-page-size="numPagerPagesize"
								is-check-type="true"
								is-selectable="true"
								class="qr2 qr-selectable"></query-result>
						</div>
					</div>
					<div class="control-group submit-group">
						<button class="wiz-prev btn" ng-click="go(1)">{{'$S_str_Previous' | translate}}</button>
						<button class="wiz-next btn" ng-click="go(widgetType.s4next(), widgetType.s4nextCallback(), widgetType.s4nextEvent())">{{'$S_str_Next' | translate}}</button>
					</div>
				</fieldset>
			</li>
			<!-- 5 -->
			<li class="wiz-step" ng-controller="ChartBindingController">
				<legend>{{'$S_str_BindingDataToChart' | translate}}</legend>
				<fieldset style="position: relative">
					<div class="fieldset-description"></div>
					<div fx-dashboard-id="binding-left">
						<div fx-dashboard-id="binding-query-result">
							<query-result
								style="position: absolute; width: calc(100% - 2px); height: 234px; overflow: auto"
								ng-template="qrTmpl"
								ng-model="qresult"
								ng-query="ctxWidget.data.query" 
								ng-page="numCurrentPage"
								ng-page-size="numPagerPagesize"
								is-check-type="true"
								class="qr2 qr-selected"></query-result>
						</div>
						<div fx-dashboard-id="config-container">
							<div fx-dashboard-id="series">
								<div fx-dashboard-id="series-list">
									<ul class="nav nav-pills nav-stacked">
										<li ng-repeat="(i, s) in dataSeries" class="clearboth" ng-class="{active: selectedSeriesIdx == i}">
											<a ng-click="selectSeries(i)">
												<span>{{s.name}}</span>
												<button class="close widget-refresh pull-right" ng-click="removeSeries(i)">
													<i class="icon-minus pull-right" ng-style="{backgroundColor: s.color}"></i>
												</button>
											</a>
										</li>
									</ul>
								</div>
								<div fx-dashboard-id="series-toolbar">
									<button class="btn" ng-click="addSeries()"><i class="icon-plus"></i>{{'$S_str_AddSeries' | translate}}</button>
								</div>
							</div>
							<div fx-dashboard-id="config">
								<div class="form-horizontal">
									<div class="control-group">
										<label class="control-label" for="widgetName">{{'$S_str_Name' | translate}}</label>
										<div class="controls">
											<input id="widgetName" type="text" ng-model="dataSeries[selectedSeriesIdx].name"/>
										</div>
									</div>
									<div class="control-group">
										<label class="control-label" for="widgetInterval">{{'$S_str_Value' | translate}}</label>
										<div class="controls">
											<select ng-model="dataSeries[selectedSeriesIdx].value" ng-options="col.name for col in dataNumberTypeCols"></select>
											<label ng-show="chartType.name == 'line'"><input type="checkbox" ng-model="dataSeries[selectedSeriesIdx].nullToZero"> {{'$S_str_NullToZero' | translate}}</label>
										</div>
									</div>
								</div>
								<div class="form-horizontal" ng-show="chartType.name == 'bar' || chartType.name == 'pie'">
									<div class="control-group">
										<label class="control-label" for="widgetInterval">{{'$S_str_Label' | translate}}</label>
										<div class="controls">
											<select ng-model="dataLabel" ng-options="col.name for col in qrCols"></select>
										</div>
									</div>
								</div>
								<div class="form-horizontal" ng-show="chartType.name == 'line'">
									<div class="control-group">
										<label class="control-label">{{'$S_str_AxisX' | translate}}</label>
										<div class="controls">
											<select ng-model="dataLabel" ng-options="col.name for col in qrCols"></select>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div fx-dashboard-id="binding-right" class="charthere"></div>
				</fieldset>
				<div class="control-group submit-group clearboth">
					<button class="wiz-prev btn" ng-click="go(4)">{{'$S_str_Previous' | translate}}</button>
					<button class="wiz-next btn" ng-click="go(3, widgetType.s5nextCallback())">{{'$S_str_Next' | translate}}</button>
				</div>
			</li>
			<!-- 6 -->
			<li class="wiz-step" ng-controller="WordCloudController">
				<legend>{{'$S_str_Preview' | translate}}</legend>
				<fieldset style="position: relative">
					<div>{{'$S_msg_ClickNextToContinue' | translate}}</div>
					<div class="cloud-preview" style="width: 600px; height: 600px; border: 1px solid silver; margin-top:10px">
					</div>
				</fieldset>
				<div class="control-group submit-group clearboth">
					<button class="wiz-prev btn" ng-click="go(4)">{{'$S_str_Previous' | translate}}</button>
					<button class="wiz-next btn" ng-click="go(3)">{{'$S_str_Next' | translate}}</button>
				</div>
			</li>
		</ol>
	</div>

	<div class="modal propertyWidget" modal ng-controller="WidgetPropertyController">
		<a class="modal-close close" style="margin-bottom: -30px">&times;</a>
		<legend>{{name}} 속성</legend>
		<div style="margin-bottom: 20px">
			위젯 속성을 확인하고 변경할 수 있습니다.
		</div>
		<form class="form-horizontal">
			<div class="control-group">
				<label class="control-label" for="dashboardWidgetPropertyInterval">새로고침 주기</label>
				<div class="controls">
					<input type="number" ng-model="interval" id="dashboardWidgetPropertyInterval">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" >쿼리</label>
				<div class="controls">
					<code style="display:inline-block; max-height:200px; overflow:auto">{{query}}</code>
				</div>
			</div>
		</form>
		<div class="control-group submit-group">
			<button class="btn" ng-click="updateWidgetProperty()">{{'$S_str_Done' | translate}}</button>
			<button class="btn" ng-click="cancelUpdateWidgetProperty()">{{'$S_str_Cancel' | translate}}</button>
		</div>
	</div>
</div>